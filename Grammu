--// COCO HUB - FULL MM2 WITH HEAD/BODY LOCK AIMBOT

local Players = game:GetService("Players")
local Plr = Players.LocalPlayer
local Camera = workspace.CurrentCamera
repeat task.wait() until Plr and Plr.Character and Plr.Character:FindFirstChild("HumanoidRootPart")

-- Rayfield UI
local success, Rayfield = pcall(function()
    return loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
end)
if not success or not Rayfield then return end

-- Vars
local ESPEnabled, highJump, aimbotOn, silentOn = false, false, false, false
local fov, silentFOV, walkSpeed = 100, 120, 16
local lockPart = "Head"
local fCircle, sCircle, sTarget
local TeamTags, TeamOn = {}, false

-- MM2 team detection
local function getTeam(p)
    local ls = p:FindFirstChild("leaderstats")
    if ls then
        local tv = ls:FindFirstChild("Team")
        if tv and tv:IsA("StringValue") then return tv.Value end
    end
    return "No Team"
end

-- Create team tag
local function createTag(p)
    if not p.Character or not p.Character:FindFirstChild("Head") then return end
    local h = p.Character.Head
    if h:FindFirstChild("TeamTagGui") then h.TeamTagGui:Destroy() end

    local gui = Instance.new("BillboardGui", h)
    gui.Name = "TeamTagGui"
    gui.Size = UDim2.new(0,100,0,30)
    gui.StudsOffset = Vector3.new(0,2.5,0)
    gui.AlwaysOnTop = true
    gui.Adornee = h

    local t = Instance.new("TextLabel", gui)
    t.Size = UDim2.fromScale(1,1)
    t.BackgroundTransparency = 1
    t.TextScaled = true
    t.Font = Enum.Font.SourceSansBold
    t.TextStrokeTransparency = 0

    if TeamTags[p] then task.cancel(TeamTags[p]) end
    TeamTags[p] = task.spawn(function()
        while TeamOn and p.Parent do
            local v = getTeam(p)
            t.Text = v
            if v == "Innocent" then t.TextColor3 = Color3.fromRGB(0,255,0)
            elseif v == "Sheriff" then t.TextColor3 = Color3.fromRGB(0,0,255)
            elseif v == "Murderer" then t.TextColor3 = Color3.fromRGB(255,0,0)
            else t.TextColor3 = Color3.fromRGB(255,255,255) end
            task.wait(0.5)
        end
        gui:Destroy()
    end)
end

local function rmTag(p)
    if TeamTags[p] then task.cancel(TeamTags[p]) end
    if p.Character and p.Character:FindFirstChild("TeamTagGui") then
        p.Character.TeamTagGui:Destroy()
    end
end

local function refreshTeam(s)
    TeamOn = s
    if s then
        for _, v in pairs(Players:GetPlayers()) do
            if v ~= Plr then createTag(v) end
        end
        Players.PlayerAdded:Connect(function(p)
            if TeamOn then
                p.CharacterAdded:Connect(function()
                    task.wait(1)
                    createTag(p)
                end)
            end
        end)
        Players.PlayerRemoving:Connect(rmTag)
    else
        for _, v in pairs(Players:GetPlayers()) do rmTag(v) end
    end
end

-- find nearest target
local function findTarget(r)
    local bestDist, bestPart = math.huge, nil
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= Plr and p.Character and p.Character:FindFirstChild(lockPart) then
            local part = p.Character[lockPart]
            local pos, on = Camera:WorldToViewportPoint(part.Position)
            if on then
                local d = (Vector2.new(pos.X,pos.Y) - Vector2.new(Camera.ViewportSize.X/2,Camera.ViewportSize.Y/2)).Magnitude
                if d < r and d < bestDist then
                    bestDist, bestPart = d, part
                end
            end
        end
    end
    return bestPart
end

-- silent aim hook
local oldNC = hookmetamethod(game, "__namecall", function(self, ...)
    local m = getnamecallmethod()
    local args = {...}
    if m == "FireServer" and tostring(self) == "Shoot" and silentOn and sTarget then
        if typeof(args[1])=="Vector3" then
            args[1] = sTarget.Position + Vector3.new(0,1.5,0)
            return oldNC(self, unpack(args))
        end
    end
    return oldNC(self, ...)
end)

-- UI
local W = Rayfield:CreateWindow({Name="COCO HUB"})
local Tab = W:CreateTab("Main")

-- ESP
Tab:CreateToggle({Name="ESP", CurrentValue=ESPEnabled, Callback=function(s)
    ESPEnabled = s
    if s then
        task.spawn(function()
            while ESPEnabled do
                task.wait(0.5)
                for _, v in pairs(Players:GetPlayers()) do
                    if v ~= Plr and v.Character and not v.Character:FindFirstChild("ESP") then
                        local hl = Instance.new("Highlight", v.Character)
                        hl.Name="ESP"; hl.FillColor=Color3.new(0,1,0)
                        hl.OutlineColor=Color3.new(1,1,0); hl.FillTransparency=0.5
                    end
                end
            end
            for _, v in pairs(Players:GetPlayers()) do
                if v.Character and v.Character:FindFirstChild("ESP") then
                    v.Character.ESP:Destroy()
                end
            end
        end)
    else
        for _, v in pairs(Players:GetPlayers()) do
            if v.Character and v.Character:FindFirstChild("ESP") then v.Character.ESP:Destroy() end
        end
    end
end})

-- HighJump
Tab:CreateToggle({Name="High Jump", CurrentValue=highJump, Callback=function(s)
    highJump = s
    local h = Plr.Character and Plr.Character:FindFirstChild("Humanoid")
    if h then h.JumpPower = s and 100 or 50 end
end})

-- WalkSpeed
Tab:CreateSlider({Name="WalkSpeed", Range={16,100}, Increment=1, CurrentValue=walkSpeed, Callback=function(v) walkSpeed=v end})
Tab:CreateToggle({Name="Enable WalkSpeed", CurrentValue=false, Callback=function(s)
    local h = Plr.Character and Plr.Character:FindFirstChild("Humanoid")
    if h then h.WalkSpeed = s and walkSpeed or 16 end
end})

-- Lock part selector
Tab:CreateDropdown({Name="Lock To", Options={"Head","HumanoidRootPart"}, CurrentOption="Head", Callback=function(v)
    lockPart=v
end})

-- Aimbot
Tab:CreateToggle({Name="Aimbot", CurrentValue=aimbotOn, Callback=function(s)
    aimbotOn = s
    if fCircle then fCircle:Remove(); fCircle=nil end
    if s then
        fCircle = Drawing.new("Circle")
        fCircle.Radius, fCircle.Thickness, fCircle.Transparency, fCircle.Filled = fov, 2, 0.5, false
        fCircle.Visible = true
        task.spawn(function()
            while aimbotOn do
                task.wait()
                fCircle.Position = Vector2.new(Camera.ViewportSize.X/2,Camera.ViewportSize.Y/2)
                fCircle.Color = Color3.fromHSV((tick()%5)/5,1,1)
                local tgt = findTarget(fov)
                if tgt then Camera.CFrame = CFrame.new(Camera.CFrame.Position, tgt.Position) end
            end
            if fCircle then fCircle:Remove() end
        end)
    end
end})
Tab:CreateSlider({Name="FOV", Range={100,500}, Increment=10, CurrentValue=fov, Callback=function(v)
    fov=v if fCircle then fCircle.Radius=v end
end})

-- Silent Aim
Tab:CreateToggle({Name="Silent Aim", CurrentValue=silentOn, Callback=function(s)
    silentOn = s
    if sCircle then sCircle:Remove(); sCircle=nil end
    if s then
        sCircle = Drawing.new("Circle")
        sCircle.Radius, sCircle.Thickness, sCircle.Transparency = silentFOV, 2, 0.5
        sCircle.Visible = true
        task.spawn(function()
            while silentOn do
                task.wait()
                sCircle.Position = Vector2.new(Camera.ViewportSize.X/2,Camera.ViewportSize.Y/2)
                sCircle.Color = Color3.fromHSV((tick()%5)/5,1,1)
                sTarget = findTarget(silentFOV)
            end
            if sCircle then sCircle:Remove() end
        end)
    end
end})
Tab:CreateSlider({Name="Silent FOV", Range={50,500}, Increment=10, CurrentValue=silentFOV, Callback=function(v)
    silentFOV=v if sCircle then sCircle.Radius=v end
end})

-- TeamTag toggle
Tab:CreateToggle({Name="Team Tags", CurrentValue=TeamOn, Callback=refreshTeam})

-- Unload
Tab:CreateButton({Name="Unload", Callback=function()
    if fCircle then fCircle:Remove() end
    if sCircle then sCircle:Remove() end
    refreshTeam(false)
    for _,v in ipairs(Players:GetPlayers()) do
        if v.Character and v.Character:FindFirstChild("ESP") then v.Character.ESP:Destroy() end
    end
    local h = Plr.Character and Plr.Character:FindFirstChild("Humanoid")
    if h then h.WalkSpeed=16; h.JumpPower=50 end
    aimbotOn = ESPEnabled = highJump = silentOn = TeamOn = false
    print("[COCO HUB] Unloaded")
end})

print("[COCO HUB] Loaded!")
