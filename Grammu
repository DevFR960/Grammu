--// COCO HUB - FULL FEATURED SCRIPT (Rayfield UI + Silent Aimbot + Auto Shoot + KeySystem - FIXED VERSION)

-- โหลด Rayfield UI Library
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "COCO HUB",
    LoadingTitle = "COCO HUB",
    LoadingSubtitle = "by DVD_LOVE",
    ConfigurationSaving = { Enabled = false },
    Discord = { Enabled = false },
    KeySystem = true,
    KeySettings = {
        Title = "COCO HUB KEY",
        Subtitle = "ใส่รหัสก่อนใช้งาน",
        Note = "POSS NGO",
        FileName = "COCOHUBKEY",
        SaveKey = false,
        GrabKeyFromSite = false,
        Key = "Flower"
    }
})

local Plr = game.Players.LocalPlayer
local camera = workspace.CurrentCamera
local isMobile = game:GetService("UserInputService").TouchEnabled

local PlayerTP, drop = nil, nil
local highJump, aimbotEnabled, hitboxEnabled = false, false, false
local fov, hitboxSize = 100, 5
local fovCircle, silentFOVCircle, silentTarget = nil, nil, nil
local silentAimbotEnabled, silentAimbotFOV = false, 100

-- รีเซ็ตค่าต่าง ๆ เมื่อรีสตัว
Plr.CharacterAdded:Connect(function()
    if fovCircle then fovCircle:Remove(); fovCircle = nil end
    if silentFOVCircle then silentFOVCircle:Remove(); silentFOVCircle = nil end
    task.wait(1)
    local hum = Plr.Character:FindFirstChild("Humanoid")
    if hum then
        hum.JumpPower = highJump and 100 or 50
    end
end)

-- ฟังก์ชันเลือกผู้เล่น
local function refreshPlayers()
    local list = {}
    for _, v in pairs(game.Players:GetPlayers()) do
        table.insert(list, v.Name)
    end
    return list
end

-- TAB: Player
local TabPlayer = Window:CreateTab("Player", 4483362458)
TabPlayer:CreateSection("Section Player!")

drop = TabPlayer:CreateDropdown({
    Name = "Select Player!",
    Options = refreshPlayers(),
    CurrentOption = "",
    Callback = function(t)
        PlayerTP = t
    end
})

TabPlayer:CreateButton({
    Name = "Click To TP",
    Callback = function()
        local target = game.Players:FindFirstChild(PlayerTP)
        if not target then return end
        local function tryTP()
            local hrp = Plr.Character and Plr.Character:FindFirstChild("HumanoidRootPart")
            local targetHrp = target.Character and target.Character:FindFirstChild("HumanoidRootPart")
            if hrp and targetHrp then
                hrp.CFrame = targetHrp.CFrame
                return true
            end
            return false
        end
        for _ = 1, 10 do
            if tryTP() then break end
            task.wait(0.1)
        end
    end
})

TabPlayer:CreateButton({
    Name = "Refresh Dropdown",
    Callback = function()
        drop:SetOptions(refreshPlayers())
    end
})

-- ESP Toggle
TabPlayer:CreateToggle({
    Name = "ESP",
    CurrentValue = false,
    Callback = function(state)
        _G.ESP = state
        local localName = Plr.Name
        if state then
            task.spawn(function()
                while _G.ESP do
                    task.wait(0.1)
                    for _, v in pairs(game.Players:GetPlayers()) do
                        if v.Name ~= localName and v.Character then
                            local hl = v.Character:FindFirstChild("ESP")
                            if hl then hl:Destroy() end
                            local newHl = Instance.new("Highlight")
                            newHl.Name = "ESP"
                            newHl.FillColor = Color3.new(0,1,0.08)
                            newHl.OutlineColor = Color3.new(0.9,1,0)
                            newHl.FillTransparency = 0.5
                            newHl.Adornee = v.Character
                            newHl.Parent = v.Character
                        end
                    end
                end
            end)
        else
            for _, v in pairs(game.Players:GetPlayers()) do
                local hl = v.Character and v.Character:FindFirstChild("ESP")
                if hl then hl:Destroy() end
            end
        end
    end
})

-- High Jump
TabPlayer:CreateToggle({
    Name = "High Jump",
    CurrentValue = false,
    Callback = function(state)
        highJump = state
        local hum = Plr.Character and Plr.Character:FindFirstChild("Humanoid")
        if hum then hum.JumpPower = state and 100 or 50 end
    end
})

-- Speed
TabPlayer:CreateSlider({
    Name = "Speed",
    Range = {16, 100},
    Increment = 1,
    CurrentValue = 16,
    Callback = function(value)
        local hum = Plr.Character and Plr.Character:FindFirstChild("Humanoid")
        if hum then hum.WalkSpeed = value end
    end
})

-- FOV Aimbot
TabPlayer:CreateToggle({
    Name = "FOV Aimbot with Rainbow Circle",
    CurrentValue = false,
    Callback = function(state)
        aimbotEnabled = state
        if state then
            if fovCircle then fovCircle:Remove() end
            fovCircle = Drawing.new("Circle")
            fovCircle.Thickness, fovCircle.Transparency, fovCircle.Radius = 2, 0.5, fov
            fovCircle.Filled, fovCircle.Visible = false, true
            task.spawn(function()
                while aimbotEnabled do
                    task.wait(0.1)
                    fovCircle.Color = Color3.fromHSV((tick() % 5) / 5, 1, 1)
                    fovCircle.Position = Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)
                    local closest, dist = nil, math.huge
                    for _, p in pairs(game.Players:GetPlayers()) do
                        if p ~= Plr and p.Team ~= Plr.Team and p.Character and p.Character:FindFirstChild("Head") then
                            local pos, onScreen = camera:WorldToViewportPoint(p.Character.Head.Position)
                            if onScreen then
                                local d = (Vector2.new(pos.X, pos.Y) - fovCircle.Position).Magnitude
                                if d < fov and d < dist then
                                    closest, dist = p.Character.Head, d
                                end
                            end
                        end
                    end
                    if closest then
                        camera.CFrame = CFrame.new(camera.CFrame.Position, closest.Position)
                    end
                end
                if fovCircle then fovCircle:Remove(); fovCircle = nil end
            end)
        elseif fovCircle then fovCircle:Remove(); fovCircle = nil end
    end
})

TabPlayer:CreateSlider({
    Name = "Aimbot FOV",
    Range = {100, 500},
    Increment = 10,
    CurrentValue = 100,
    Callback = function(value)
        fov = value
        if fovCircle then fovCircle.Radius = value end
    end
})

-- Hitbox Expander
TabPlayer:CreateToggle({
    Name = "Hitbox Expander (Players)",
    CurrentValue = false,
    Callback = function(state)
        hitboxEnabled = state
    end
})

TabPlayer:CreateSlider({
    Name = "Hitbox Size",
    Range = {5, 100},
    Increment = 5,
    CurrentValue = 5,
    Callback = function(value)
        hitboxSize = math.clamp(value, 5, 100)
    end
})

-- Hitbox Loop
spawn(function()
    while true do
        task.wait(0.1)
        for _, player in ipairs(game.Players:GetPlayers()) do
            if player ~= Plr and player.Character then
                local hrp = player.Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    if hitboxEnabled then
                        hrp.Size = Vector3.new(hitboxSize, hitboxSize, hitboxSize)
                        hrp.Transparency, hrp.Material, hrp.Color = 0.7, Enum.Material.Neon, Color3.new(1,0,0)
                        hrp.CanCollide = false
                    else
                        hrp.Size = Vector3.new(2, 2, 1)
                        hrp.Transparency, hrp.Material, hrp.Color = 1, Enum.Material.Plastic, Color3.new(1,1,1)
                        hrp.CanCollide = true
                    end
                end
            end
        end
    end
end)

-- Silent Aimbot
local TabSA = Window:CreateTab("Silent Aimbot", 4483362458)
TabSA:CreateSection("Silent Aimbot Settings")

TabSA:CreateToggle({
    Name = "Enable Silent Aimbot",
    CurrentValue = false,
    Callback = function(state)
        silentAimbotEnabled = state
        if state then
            if silentFOVCircle then silentFOVCircle:Remove() end
            silentFOVCircle = Drawing.new("Circle")
            silentFOVCircle.Thickness, silentFOVCircle.Transparency, silentFOVCircle.Radius = 2, 0.5, silentAimbotFOV
            silentFOVCircle.Filled, silentFOVCircle.Visible = false, true
            task.spawn(function()
                while silentAimbotEnabled do
                    task.wait(0.1)
                    silentFOVCircle.Color = Color3.fromHSV((tick() % 5) / 5, 1, 1)
                    silentFOVCircle.Position = Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)
                    local closest, dist = nil, math.huge
                    for _, p in pairs(game.Players:GetPlayers()) do
                        if p ~= Plr and p.Team ~= Plr.Team and p.Character and p.Character:FindFirstChild("Head") then
                            local pos, onScreen = camera:WorldToViewportPoint(p.Character.Head.Position)
                            if onScreen then
                                local d = (Vector2.new(pos.X,pos.Y) - silentFOVCircle.Position).Magnitude
                                if d < silentAimbotFOV and d < dist then
                                    closest, dist = p.Character.Head, d
                                end
                            end
                        end
                    end
                    silentTarget = closest
                end
                silentTarget = nil
                if silentFOVCircle then silentFOVCircle:Remove(); silentFOVCircle = nil end
            end)
        elseif silentFOVCircle then silentFOVCircle:Remove(); silentFOVCircle = nil end
    end
})

TabSA:CreateSlider({
    Name = "Silent Aimbot FOV",
    Range = {100, 500},
    Increment = 10,
    CurrentValue = 100,
    Callback = function(value)
        silentAimbotFOV = value
        if silentFOVCircle then silentFOVCircle.Radius = value end
    end
})

-- Auto Shoot Silent Aimbot
spawn(function()
    while true do
        task.wait(0.05)
        if silentAimbotEnabled and silentTarget then
            local tool = Plr.Character and Plr.Character:FindFirstChildOfClass("Tool")
            if tool then
                local remote = tool:FindFirstChildWhichIsA("RemoteEvent")
                if remote then
                    pcall(function()
                        if remote.Name:lower():find("shoot") then
                            remote:FireServer(silentTarget.Position)
                        else
                            tool:Activate()
                        end
                    end)
                    task.wait(0.2)
                end
            end
        end
    end
end)
