-- Load ArrayField library
local ArrayField = loadstring(game:HttpGet("https://raw.githubusercontent.com/Hosvile/Refinement/main/MC%3AArrayfield%20Library"))()

-- Create main window
local Window = ArrayField:CreateWindow({
    Name = "COCO HUB",
    LoadingTitle = "COCO HUB",
    LoadingSubtitle = "by COCO",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "COCOHUB",
        FileName = "COCOHUB_Config"
    }
})

-- Create main tab
local MainTab = Window:CreateTab("Main")

-- Create sections
local AimbotSection = MainTab:CreateSection("Aimbot Settings")
local VisualsSection = MainTab:CreateSection("Visuals")
local MiscSection = MainTab:CreateSection("Miscellaneous")
local ESPSection = MainTab:CreateSection("ESP") -- ESP section added

-- Toggle for Aimbot
local AimbotToggle = AimbotSection:CreateToggle({
    Name = "Enable Aimbot",
    CurrentValue = false,
    Callback = function(value)
        State.Aimbot = value
    end
})

-- Toggle for Silent Aim
local SilentAimToggle = AimbotSection:CreateToggle({
    Name = "Enable Silent Aim",
    CurrentValue = false,
    Callback = function(value)
        State.SilentAim = value
    end
})

-- Dropdown for Lock Part
local LockPartDropdown = AimbotSection:CreateDropdown({
    Name = "Lock Part",
    Options = {"Head", "HumanoidRootPart"},
    CurrentOption = "Head",
    Callback = function(selected)
        State.LockPart = selected
    end
})

-- Slider for FOV radius
local FOVSlider = AimbotSection:CreateSlider({
    Name = "FOV Radius",
    Range = {10, 360},
    Increment = 1,
    CurrentValue = 160,
    Callback = function(value)
        State.FOV = value
    end
})

-- Toggle for Rainbow FOV
local RainbowFOVToggle = AimbotSection:CreateToggle({
    Name = "Rainbow FOV",
    CurrentValue = true,
    Callback = function(value)
        State.RainbowFOV = value
    end
})

-- Miscellaneous toggles
local WallCheckToggle = MiscSection:CreateToggle({
    Name = "Wall Check",
    CurrentValue = true,
    Callback = function(value)
        State.WallCheck = value
    end
})

local TeamCheckToggle = MiscSection:CreateToggle({
    Name = "Team Check",
    CurrentValue = true,
    Callback = function(value)
        State.TeamCheck = value
    end
})

------------------------------------------------------
-- ESP Section
------------------------------------------------------

-- Variables for ESP state and color
local ESPEnabled = false
local ESPColor = Color3.new(1, 0, 0) -- default red color

-- Function to create ESP highlight for a player
local function createESPForPlayer(player)
    if not player.Character then return end
    local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end

    local highlight = Instance.new("Highlight")
    highlight.Name = "ESPHighlight"
    highlight.Adornee = humanoidRootPart
    highlight.Parent = player.Character
    highlight.FillColor = ESPColor
    highlight.OutlineColor = ESPColor
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.Enabled = ESPEnabled
end

-- Function to toggle ESP
local function toggleESP(state)
    ESPEnabled = state
    for _, player in pairs(game.Players:GetPlayers()) do
        local highlight = player.Character and player.Character:FindFirstChild("ESPHighlight")
        if highlight then
            highlight.Enabled = state
        elseif state and player.Character then
            createESPForPlayer(player)
        end
    end
end

-- Function to update ESP color
local function updateESPColor(newColor)
    ESPColor = newColor
    for _, player in pairs(game.Players:GetPlayers()) do
        local highlight = player.Character and player.Character:FindFirstChild("ESPHighlight")
        if highlight then
            highlight.FillColor = newColor
            highlight.OutlineColor = newColor
        end
    end
end

-- When new players join, create ESP if enabled
game.Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        if ESPEnabled then
            createESPForPlayer(player)
        end
    end)
end)

-- UI toggle for ESP
local ESPToggle = ESPSection:CreateToggle({
    Name = "Enable ESP",
    CurrentValue = false,
    Callback = function(value)
        toggleESP(value)
    end
})

-- UI color picker for ESP color (if supported by your UI framework)
local ESPColorPicker = ESPSection:CreateColorPicker({
    Name = "ESP Color",
    CurrentColor = ESPColor,
    Callback = function(newColor)
        updateESPColor(newColor)
    end
})

-- Note: If your UI framework does not support ColorPicker, you can replace it with a dropdown or sliders for RGB values.
