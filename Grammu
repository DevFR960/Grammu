-- COCO HUB - FULL DELTA COMPATIBLE VERSION
-- YOU NEED TO INSERT YOUR OWN Rayfield LOADER
-- example: local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera

-- Variables
local FOVCircle
local AimbotEnabled = false
local SilentAimEnabled = false
local AimbotTargetPart = "Head"
local FlyEnabled = false
local FlySpeed = 5
local ESPEnabled = false
local HitboxExpandEnabled = false
local InvisibleEnabled = false
local WalkSpeedValue = 16
local JumpPowerValue = 50

-- GUI LOADER (Rayfield)
local Rayfield = Rayfield -- You insert loadstring loader yourself!

-- UI SETUP
local Window = Rayfield:CreateWindow({
   Name = "COCO HUB - MM2 | Delta Compatible",
   LoadingTitle = "COCO HUB",
   LoadingSubtitle = "by Dechatorn",
   ConfigurationSaving = {
      Enabled = false
   },
   Discord = {Enabled = false},
   KeySystem = false
})

-- PAGE
local Main = Window:CreateTab("Main")
local Combat = Window:CreateTab("Combat")
local Visual = Window:CreateTab("Visual")
local Movement = Window:CreateTab("Movement")
local Utility = Window:CreateTab("Utility")

-- FOV CIRCLE
function DrawFOV()
   if FOVCircle then FOVCircle:Remove() end
   local circle = Drawing.new("Circle")
   circle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
   circle.Radius = 100
   circle.Thickness = 2
   circle.Filled = false
   circle.Transparency = 1
   circle.Visible = true

   task.spawn(function()
      while AimbotEnabled or SilentAimEnabled do
         circle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
         circle.Color = Color3.fromHSV(tick()%5/5, 1, 1)
         task.wait()
      end
      circle:Remove()
   end)

   FOVCircle = circle
end

-- TARGET FINDER
function GetClosestTarget()
   local closest = nil
   local shortest = math.huge
   for _, plr in ipairs(Players:GetPlayers()) do
      if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
         local screenPos, onScreen = Camera:WorldToViewportPoint(plr.Character.HumanoidRootPart.Position)
         if onScreen then
            local distance = (Vector2.new(screenPos.X, screenPos.Y) - Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)).Magnitude
            if distance < shortest and distance <= 100 then
               closest = plr
               shortest = distance
            end
         end
      end
   end
   return closest
end

-- AIMBOT
RunService.RenderStepped:Connect(function()
   if AimbotEnabled then
      local target = GetClosestTarget()
      if target and target.Character and target.Character:FindFirstChild(AimbotTargetPart) then
         Camera.CFrame = CFrame.new(Camera.CFrame.Position, target.Character[AimbotTargetPart].Position)
      end
   end
end)

-- SILENT AIM
local __namecall
__namecall = hookmetamethod(game, "__namecall", function(...)
   local method = getnamecallmethod()
   local args = {...}
   if SilentAimEnabled and tostring(method) == "FireServer" and tostring(args[1]) == "Hit" then
      local target = GetClosestTarget()
      if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
         args[2] = target.Character.HumanoidRootPart.Position
         return __namecall(unpack(args))
      end
   end
   return __namecall(...)
end)

-- ESP
function EnableESP()
   for _, plr in ipairs(Players:GetPlayers()) do
      if plr ~= LocalPlayer then
         local box = Instance.new("BillboardGui", plr.Character)
         box.Name = "ESPBox"
         box.Size = UDim2.new(0, 100, 0, 20)
         box.AlwaysOnTop = true
         local label = Instance.new("TextLabel", box)
         label.Size = UDim2.new(1, 0, 1, 0)
         label.Text = plr.Name
         label.BackgroundTransparency = 1
         label.TextColor3 = Color3.new(1, 0, 0)
      end
   end
end

function DisableESP()
   for _, plr in ipairs(Players:GetPlayers()) do
      local esp = plr.Character and plr.Character:FindFirstChild("ESPBox")
      if esp then esp:Destroy() end
   end
end

-- FLY SYSTEM
local flyVel, flyGyro
function ToggleFly(state)
   if state then
      flyVel = Instance.new("BodyVelocity")
      flyVel.Velocity = Vector3.zero
      flyVel.MaxForce = Vector3.new(1, 1, 1) * 100000
      flyVel.Parent = LocalPlayer.Character:WaitForChild("HumanoidRootPart")

      flyGyro = Instance.new("BodyGyro")
      flyGyro.CFrame = Camera.CFrame
      flyGyro.MaxTorque = Vector3.new(1, 1, 1) * 100000
      flyGyro.Parent = LocalPlayer.Character.HumanoidRootPart

      RunService.Stepped:Connect(function()
         if FlyEnabled then
            flyVel.Velocity = Camera.CFrame.LookVector * FlySpeed
            flyGyro.CFrame = Camera.CFrame
         end
      end)
   else
      if flyVel then flyVel:Destroy() end
      if flyGyro then flyGyro:Destroy() end
   end
end

-- TEAM TAGS
function ShowRoleTags()
   for _, plr in ipairs(Players:GetPlayers()) do
      if plr:FindFirstChild("leaderstats") and plr.leaderstats:FindFirstChild("Team") then
         local role = plr.leaderstats.Team.Value
         local tag = Instance.new("BillboardGui", plr.Character)
         tag.Name = "RoleTag"
         tag.Size = UDim2.new(0, 100, 0, 20)
         tag.AlwaysOnTop = true
         local label = Instance.new("TextLabel", tag)
         label.Size = UDim2.new(1, 0, 1, 0)
         label.Text = role
         label.TextColor3 = role == "Murderer" and Color3.new(1, 0, 0)
                      or role == "Sheriff" and Color3.new(0, 0, 1)
                      or Color3.new(0, 1, 0)
         label.BackgroundTransparency = 1
      end
   end
end

-- TOGGLES
Combat:CreateToggle({
   Name = "Aimbot",
   CurrentValue = false,
   Callback = function(v)
      AimbotEnabled = v
      if v then DrawFOV() end
   end
})

Combat:CreateToggle({
   Name = "Silent Aimbot",
   CurrentValue = false,
   Callback = function(v)
      SilentAimEnabled = v
      if v then DrawFOV() end
   end
})

Visual:CreateToggle({
   Name = "ESP",
   CurrentValue = false,
   Callback = function(v)
      ESPEnabled = v
      if v then EnableESP() else DisableESP() end
   end
})

Utility:CreateToggle({
   Name = "Team Tags (MM2)",
   CurrentValue = false,
   Callback = function(v)
      if v then ShowRoleTags() end
   end
})

Movement:CreateSlider({
   Name = "WalkSpeed",
   Range = {16, 200},
   Increment = 1,
   CurrentValue = 16,
   Callback = function(val)
      WalkSpeedValue = val
      LocalPlayer.Character.Humanoid.WalkSpeed = val
   end
})

Movement:CreateSlider({
   Name = "High Jump",
   Range = {50, 300},
   Increment = 1,
   CurrentValue = 50,
   Callback = function(val)
      JumpPowerValue = val
      LocalPlayer.Character.Humanoid.JumpPower = val
   end
})

Movement:CreateToggle({
   Name = "Fly Mode",
   CurrentValue = false,
   Callback = function(v)
      FlyEnabled = v
      ToggleFly(v)
   end
})

Movement:CreateSlider({
   Name = "Fly Speed",
   Range = {1, 100},
   Increment = 1,
   CurrentValue = 5,
   Callback = function(val)
      FlySpeed = val
   end
})

-- Toggle GUI
UIS.InputBegan:Connect(function(input)
   if input.KeyCode == Enum.KeyCode.RightControl then
      Rayfield:Toggle()
   end
end)
