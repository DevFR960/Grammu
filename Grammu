-- COCO HUB | Delta/Xeno/KRNL Compatible (Rayfield UI only, No AutoShoot)
-- Invisible via GitHub raw URL

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- ================= State =================
local State = {
    Aimbot=false, SilentAim=false,
    Hitbox=false, Invisible=false,
    Fly=false, FlySpeed=40,
    WalkSpeed=16, JumpPower=50,
    AimbotPart="Head",
    FOVRadius=120, FOVRainbow=true,
    ESP=true, TargetESP=true,
    HitboxSize=10
}

-- ================= Rayfield UI =================
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Window = Rayfield:CreateWindow({
    Name = "COCO HUB | Delta Pro Ultimate",
    LoadingTitle = "COCO HUB Loading",
    ConfigFolder = "COCO_HUB_Delta"
})

-- Tabs
local MainTab = Window:CreateTab("Combat")
local MoveTab = Window:CreateTab("Movement")
local ESPTab = Window:CreateTab("ESP")
local MiscTab = Window:CreateTab("Misc")

-- ================= Combat Tab =================
local MainSection = MainTab:CreateSection("Combat")
MainSection:CreateToggle({Name="Aimbot", CurrentValue=false, Callback=function(v) State.Aimbot=v end})
MainSection:CreateToggle({Name="Silent Aim", CurrentValue=false, Callback=function(v) State.SilentAim=v end})
MainSection:CreateSlider({Name="Hitbox Size", Range={10,500}, Increment=1, CurrentValue=10, Callback=function(v) State.HitboxSize=v end})
MainSection:CreateDropdown({Name="Aimbot Part", Options={"Head","HumanoidRootPart"}, CurrentOption="Head", Callback=function(v) State.AimbotPart=v end})
MainSection:CreateSlider({Name="FOV Radius", Range={50,1000}, Increment=1, CurrentValue=120, Callback=function(v) State.FOVRadius=v end})
MainSection:CreateToggle({Name="Rainbow FOV", CurrentValue=true, Callback=function(v) State.FOVRainbow=v end})

-- ================= Movement Tab =================
local MoveSection = MoveTab:CreateSection("Player")
MoveSection:CreateSlider({Name="WalkSpeed", Range={16,200}, Increment=1, CurrentValue=16, Callback=function(v) State.WalkSpeed=v end})
MoveSection:CreateSlider({Name="JumpPower", Range={50,300}, Increment=1, CurrentValue=50, Callback=function(v) State.JumpPower=v end})
MoveSection:CreateToggle({Name="Fly", CurrentValue=false, Callback=function(v) State.Fly=v end})
MoveSection:CreateSlider({Name="Fly Speed", Range={10,200}, Increment=1, CurrentValue=40, Callback=function(v) State.FlySpeed=v end})

-- ================= ESP Tab =================
local ESPSection = ESPTab:CreateSection("ESP")
ESPSection:CreateToggle({Name="Enable ESP", CurrentValue=true, Callback=function(v) State.ESP=v end})
ESPSection:CreateToggle({Name="Target ESP", CurrentValue=true, Callback=function(v) State.TargetESP=v end})

-- ================= Misc Tab =================
local MiscSection = MiscTab:CreateSection("Misc")
MiscSection:CreateToggle({Name="Invisible (GitHub)", CurrentValue=false, Callback=function(v) State.Invisible=v end})

-- ================= Invisible (GitHub raw URL) =================
local InvisibleFn
local ok, res = pcall(function()
    local body = game:HttpGet("https://raw.githubusercontent.com/DevFR960/Grammu/refs/heads/main/Grammu")
    local fn = loadstring(body)
    if type(fn)=="function" then return fn end
end)
if ok and res then InvisibleFn = res end

local InvisibleStore = {}

local function applyInvisible(char)
    if not char then return end
    InvisibleStore[char] = {}
    for _,part in pairs(char:GetChildren()) do
        if part:IsA("BasePart") then
            InvisibleStore[char][part] = {Transparency=part.Transparency, CanCollide=part.CanCollide}
            pcall(function() part.Transparency=1 part.CanCollide=false end)
        elseif part:IsA("Accessory") then
            local handle = part:FindFirstChildWhichIsA("BasePart")
            if handle then
                InvisibleStore[char][handle] = {Transparency=handle.Transparency, CanCollide=handle.CanCollide}
                pcall(function() handle.Transparency=1 handle.CanCollide=false end)
            end
        end
    end
end

local function restoreInvisible(char)
    if not char or not InvisibleStore[char] then return end
    for part,props in pairs(InvisibleStore[char]) do
        if part and part.Parent then
            pcall(function() part.Transparency=props.Transparency part.CanCollide=props.CanCollide end)
        end
    end
    InvisibleStore[char] = nil
end

-- ================= ESP + FOV =================
local ESPObjects = {}
local FOVCircle = nil
if pcall(function() return Drawing end) then
    FOVCircle = Drawing.new("Circle")
    FOVCircle.Color = Color3.fromRGB(0,255,255)
    FOVCircle.Thickness = 2
    FOVCircle.Filled = false
    FOVCircle.Visible = true
    FOVCircle.Radius = State.FOVRadius
end

local function CreateESP(p)
    if ESPObjects[p] then return ESPObjects[p] end
    local box = Drawing.new("Square")
    box.Color = Color3.fromRGB(255,0,0)
    box.Thickness = 2
    box.Filled = false
    box.Visible = false
    ESPObjects[p] = box
    return box
end

-- ================= Core Loop =================
local CurrentTarget = nil
RunService.RenderStepped:Connect(function()
    local vw, vh = Camera.ViewportSize.X, Camera.ViewportSize.Y

    -- update FOV
    if FOVCircle then
        FOVCircle.Position = Vector2.new(vw/2, vh/2)
        FOVCircle.Radius = State.FOVRadius
        if State.FOVRainbow then
            local hue = (tick()%5)/5
            FOVCircle.Color = Color3.fromHSV(hue,1,1)
        end
    end

    local char = LocalPlayer.Character
    if char then
        local hum = char:FindFirstChildOfClass("Humanoid")
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if hum then pcall(function() hum.WalkSpeed=State.WalkSpeed hum.JumpPower=State.JumpPower end) end
        if hrp and State.Fly then
            local dir=Vector3.new()
            if UIS:IsKeyDown(Enum.KeyCode.W) then dir=dir+Camera.CFrame.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.S) then dir=dir-Camera.CFrame.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.A) then dir=dir-Camera.CFrame.RightVector end
            if UIS:IsKeyDown(Enum.KeyCode.D) then dir=dir+Camera.CFrame.RightVector end
            if dir.Magnitude>0 then hrp.Velocity=dir.Unit*State.FlySpeed else hrp.Velocity=Vector3.new(0,0,0) end
        end
        -- Invisible
        if State.Invisible then
            if InvisibleFn then pcall(function() InvisibleFn() end) end
            applyInvisible(char)
        else
            restoreInvisible(char)
        end
    end

    -- Hitbox
    if State.Hitbox then
        for _,p in pairs(Players:GetPlayers()) do
            if p~=LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                p.Character.HumanoidRootPart.Size = Vector3.new(State.HitboxSize,State.HitboxSize,State.HitboxSize)
            end
        end
    end

    -- Acquire target for Aimbot/SilentAim
    CurrentTarget = nil
    if State.Aimbot or State.SilentAim then
        local best = State.FOVRadius
        for _,p in pairs(Players:GetPlayers()) do
            if p~=LocalPlayer and p.Character and p.Character:FindFirstChild(State.AimbotPart) then
                local sp, onScreen = Camera:WorldToViewportPoint(p.Character[State.AimbotPart].Position)
                if onScreen then
                    local d = (Vector2.new(sp.X,sp.Y)-Vector2.new(vw/2,vh/2)).Magnitude
                    if d<best then best=d CurrentTarget=p end
                end
            end
        end
    end

    -- ESP
    for _,p in pairs(Players:GetPlayers()) do
        if p~=LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            local box = CreateESP(p)
            local sp, onScreen = Camera:WorldToViewportPoint(p.Character.HumanoidRootPart.Position)
            if onScreen and State.ESP then
                box.Position=Vector2.new(sp.X-25,sp.Y-25)
                box.Size=Vector2.new(50,50)
                box.Visible=true
                if State.TargetESP and CurrentTarget then
                    box.Color=(p==CurrentTarget) and Color3.fromRGB(0,255,0) or Color3.fromRGB(255,0,0)
                else
                    box.Color=Color3.fromRGB(255,0,0)
                end
            else
                box.Visible=false
            end
        end
    end
end)

-- ================= Hotkey =================
UIS.InputBegan:Connect(function(input,gp)
    if gp then return end
    if input.KeyCode==Enum.KeyCode.RightShift then
        Window:Toggle()
    end
end)

print("COCO HUB loaded: Rayfield UI | Invisible source: "..(InvisibleFn and "GitHub" or "None"))
