--// COCO HUB - FINAL FULL ENGLISH VERSION WITH RAYFIELD UI & BULLET REDIRECT
local success, Rayfield = pcall(function()
	return loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
end)

if not success or not Rayfield then
	warn("❌ Failed to load Rayfield UI.")
	return
end

-- ส่วนอื่นๆ (เช่น Silent Aim, ESP, WalkSpeed, High Jump, Aimbot, Team Tags)
-- จะใส่ต่อในโครงสร้าง Rayfield UI ด้านล่างนี้

local Players = game:GetService("Players")
local Plr = Players.LocalPlayer
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
repeat task.wait() until Plr and Plr.Character and Plr.Character:FindFirstChild("HumanoidRootPart")

-- Variable Setup
local aimbotEnabled, silentAimbotEnabled, ESPEnabled = false, false, false
local highJumpEnabled, walkSpeedToggle = false, false
local TeamTagEnabled = false
local walkSpeedVal = 16
local fov, silentFov = 100, 120
local fovCircle, silentFovCircle, silentTarget
local TeamTags = {}

-- Rayfield Window
local Window = Rayfield:CreateWindow({
	Name = "COCO HUB",
	LoadingTitle = "COCO HUB",
	LoadingSubtitle = "with Rayfield UI",
	ConfigurationSaving = { Enabled = false },
	Discord = { Enabled = false },
	KeySystem = false
})

-- Create Tabs
local Tab = Window:CreateTab("Main", 4483362458)

-- Aimbot Toggle
Tab:CreateToggle({
	Name = "Aimbot (FOV + Rainbow)",
	CurrentValue = false,
	Callback = function(state)
		aimbotEnabled = state
	end
})

-- Silent Aim Toggle
Tab:CreateToggle({
	Name = "Silent Aimbot (Bullet Redirect)",
	CurrentValue = false,
	Callback = function(state)
		silentAimbotEnabled = state
	end
})

-- ESP Toggle
Tab:CreateToggle({
	Name = "ESP (Highlight)",
	CurrentValue = false,
	Callback = function(state)
		ESPEnabled = state
		if ESPEnabled then
			task.spawn(function()
				while ESPEnabled do
					task.wait(0.5)
					for _, v in pairs(Players:GetPlayers()) do
						if v ~= Plr and v.Character and not v.Character:FindFirstChild("ESP") then
							local hl = Instance.new("Highlight")
							hl.Name = "ESP"
							hl.FillColor = Color3.fromRGB(0, 255, 20)
							hl.OutlineColor = Color3.fromRGB(230, 255, 0)
							hl.FillTransparency = 0.5
							hl.OutlineTransparency = 0
							hl.Adornee = v.Character
							hl.Parent = v.Character
						end
					end
				end
				for _, v in pairs(Players:GetPlayers()) do
					if v.Character and v.Character:FindFirstChild("ESP") then
						v.Character.ESP:Destroy()
					end
				end
			end)
		end
	end
})

-- WalkSpeed Slider
Tab:CreateSlider({
	Name = "WalkSpeed",
	Range = {16, 200},
	Increment = 1,
	CurrentValue = walkSpeedVal,
	Callback = function(val)
		walkSpeedVal = val
	end
})

-- Enable WalkSpeed
Tab:CreateToggle({
	Name = "Enable WalkSpeed",
	CurrentValue = false,
	Callback = function(state)
		walkSpeedToggle = state
	end
})

-- High Jump
Tab:CreateToggle({
	Name = "High Jump",
	CurrentValue = false,
	Callback = function(state)
		highJumpEnabled = state
	end
})

-- Team Tag
Tab:CreateToggle({
	Name = "Show Team Tags",
	CurrentValue = false,
	Callback = function(state)
		TeamTagEnabled = state
	end
})

-- Run Loop
RunService.RenderStepped:Connect(function()
	local hum = Plr.Character and Plr.Character:FindFirstChild("Humanoid")
	if hum then
		if walkSpeedToggle then hum.WalkSpeed = walkSpeedVal else hum.WalkSpeed = 16 end
		if highJumpEnabled then hum.JumpPower = 100 else hum.JumpPower = 50 end
	end

	if aimbotEnabled then
		if not fovCircle then
			fovCircle = Drawing.new("Circle")
			fovCircle.Thickness = 2
			fovCircle.Transparency = 0.5
			fovCircle.Radius = fov
			fovCircle.Filled = false
			fovCircle.Visible = true
		end
		fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
		fovCircle.Color = Color3.fromHSV((tick() % 5) / 5, 1, 1)

		local closest, dist = nil, math.huge
		for _, p in pairs(Players:GetPlayers()) do
			if p ~= Plr and p.Character and p.Character:FindFirstChild("Head") then
				local pos, onScreen = Camera:WorldToViewportPoint(p.Character.Head.Position)
				if onScreen then
					local d = (Vector2.new(pos.X, pos.Y) - fovCircle.Position).Magnitude
					if d < fov and d < dist then
						closest, dist = p.Character.Head, d
					end
				end
			end
		end
		if closest then
			Camera.CFrame = CFrame.new(Camera.CFrame.Position, closest.Position)
		end
	else
		if fovCircle then fovCircle:Remove(); fovCircle = nil end
	end

	if silentAimbotEnabled then
		if not silentFovCircle then
			silentFovCircle = Drawing.new("Circle")
			silentFovCircle.Thickness = 2
			silentFovCircle.Transparency = 0.5
			silentFovCircle.Radius = silentFov
			silentFovCircle.Filled = false
			silentFovCircle.Visible = true
		end
		silentFovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
		silentFovCircle.Color = Color3.fromHSV((tick() % 5) / 5, 1, 1)

		local closest = nil
		local dist = math.huge
		for _, p in pairs(Players:GetPlayers()) do
			if p ~= Plr and p.Character and p.Character:FindFirstChild("Head") then
				local pos, onScreen = Camera:WorldToViewportPoint(p.Character.Head.Position)
				if onScreen then
					local mag = (Vector2.new(pos.X, pos.Y) - silentFovCircle.Position).Magnitude
					if mag < silentFov and mag < dist then
						closest, dist = p.Character.Head, mag
					end
				end
			end
		end
		silentTarget = closest
	else
		if silentFovCircle then silentFovCircle:Remove(); silentFovCircle = nil end
		silentTarget = nil
	end
end)

-- Hook __namecall for Bullet Redirect
local mt = getrawmetatable(game)
setreadonly(mt, false)
local old = mt.__namecall

mt.__namecall = newcclosure(function(self, ...)
	local args = {...}
	local method = getnamecallmethod()
	if tostring(method) == "FireServer" and tostring(self.Name) == "Shoot" then
		if silentAimbotEnabled and silentTarget and typeof(args[1]) == "Vector3" then
			args[1] = silentTarget.Position + Vector3.new(0,1.5,0)
			return old(self, unpack(args))
		end
	end
	return old(self, ...)
end)

print("[COCO HUB] LOADED SUCCESSFULLY WITH RAYFIELD UI")
