-- COCO HUB FULL SCRIPT FOR DELTA EXECUTOR (NO CALLBACK ERROR)
-- Rayfield UI
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Players, RunService, UIS = game:GetService("Players"), game:GetService("RunService"), game:GetService("UserInputService")
local Plr = Players.LocalPlayer
local Mouse = Plr:GetMouse()
local Camera = workspace.CurrentCamera

-- Variables
local AimbotOn, SilentAimOn, LockPart = false, false, "Head"
local ESPOn, FlyOn, InvisiOn, HitboxOn = false, false, false, false
local WalkSpeed, JumpPower, FlySpeed, HitboxSize = 16, 50, 3, 2
local GUIVisible = true

-- UI
local Window = Rayfield:CreateWindow({ Name = "COCO HUB - MM2 FULL", ConfigurationSaving = {Enabled = false}, Discord = {Enabled = false}})

-- MAIN TAB
local MainTab = Window:CreateTab("‚öôÔ∏è Main")

MainTab:CreateSlider({
	Name = "WalkSpeed",
	Range = {16, 200},
	Increment = 1,
	Default = 16,
	Callback = function(Value) Plr.Character.Humanoid.WalkSpeed = Value end
})

MainTab:CreateSlider({
	Name = "High Jump",
	Range = {50, 200},
	Increment = 5,
	Default = 50,
	Callback = function(Value) Plr.Character.Humanoid.JumpPower = Value end
})

-- AIMBOT
local AimbotTab = Window:CreateTab("üéØ Aimbot")

AimbotTab:CreateDropdown({
	Name = "Aimbot Lock Part",
	Options = {"Head", "HumanoidRootPart"},
	CurrentOption = "Head",
	Callback = function(Part) LockPart = Part end
})

AimbotTab:CreateToggle({
	Name = "Enable Aimbot + Rainbow FOV",
	CurrentValue = false,
	Callback = function(Value)
		AimbotOn = Value
	end
})

-- Silent Aim
AimbotTab:CreateToggle({
	Name = "Enable Silent Aim",
	CurrentValue = false,
	Callback = function(Value)
		SilentAimOn = Value
	end
})

-- ESP TAB
local ESPTab = Window:CreateTab("üßø ESP")
ESPTab:CreateToggle({
	Name = "Enable Player ESP",
	CurrentValue = false,
	Callback = function(Value)
		ESPOn = Value
	end
})

-- HITBOX
local HitboxTab = Window:CreateTab("üì¶ Hitbox")
HitboxTab:CreateSlider({
	Name = "Hitbox Size",
	Range = {2, 500},
	Increment = 5,
	Default = 2,
	Callback = function(Value)
		HitboxSize = Value
	end
})
HitboxTab:CreateToggle({
	Name = "Enable Hitbox Expand (Players)",
	CurrentValue = false,
	Callback = function(Value)
		HitboxOn = Value
	end
})

-- TELEPORT
local TpTab = Window:CreateTab("üöÄ Teleport")
local PlayerDropdown = nil
local PlayerList = {}

local function RefreshPlayers()
	PlayerList = {}
	for _, v in ipairs(Players:GetPlayers()) do
		if v ~= Plr then table.insert(PlayerList, v.Name) end
	end
	if PlayerDropdown then PlayerDropdown:Refresh(PlayerList, true) end
end

PlayerDropdown = TpTab:CreateDropdown({
	Name = "Choose Player to Teleport",
	Options = PlayerList,
	CurrentOption = "",
	Callback = function(Value)
		local Target = Players:FindFirstChild(Value)
		if Target and Target.Character and Target.Character:FindFirstChild("HumanoidRootPart") then
			Plr.Character:PivotTo(Target.Character.HumanoidRootPart.CFrame + Vector3.new(0, 3, 0))
		end
	end
})

TpTab:CreateButton({
	Name = "üîÅ Refresh Player List",
	Callback = RefreshPlayers
})

-- FLY SYSTEM
local FlyTab = Window:CreateTab("üïäÔ∏è Fly + Invisible")
FlyTab:CreateSlider({
	Name = "Fly Speed",
	Range = {1, 10},
	Increment = 0.5,
	Default = 3,
	Callback = function(Value)
		FlySpeed = Value
	end
})

FlyTab:CreateToggle({
	Name = "Enable Fly",
	CurrentValue = false,
	Callback = function(Value)
		FlyOn = Value
	end
})

FlyTab:CreateButton({
	Name = "Invisible",
	Callback = function()
		if Plr.Character and Plr.Character:FindFirstChild("HumanoidRootPart") then
			Plr.Character.HumanoidRootPart.Transparency = 1
			Plr.Character.Head.Transparency = 1
			InvisiOn = true
		end
	end
})

FlyTab:CreateButton({
	Name = "Visible",
	Callback = function()
		if Plr.Character and Plr.Character:FindFirstChild("HumanoidRootPart") then
			Plr.Character.HumanoidRootPart.Transparency = 0
			Plr.Character.Head.Transparency = 0
			InvisiOn = false
		end
	end
})

-- TOGGLE UI
MainTab:CreateKeybind({
	Name = "Toggle UI",
	CurrentKeybind = "RightShift",
	HoldToInteract = false,
	Callback = function()
		GUIVisible = not GUIVisible
		Rayfield:Toggle()
	end,
})

-------------------------------
-- TEAM TAGS SYSTEM (MM2)
RunService.RenderStepped:Connect(function()
	for _, plr in pairs(Players:GetPlayers()) do
		if plr.Character and not plr.Character:FindFirstChild("COCOTag") and plr:FindFirstChild("leaderstats") and plr.leaderstats:FindFirstChild("Team") then
			local tag = Instance.new("BillboardGui", plr.Character)
			tag.Name = "COCOTag"
			tag.Adornee = plr.Character:FindFirstChild("Head")
			tag.Size = UDim2.new(0, 100, 0, 20)
			tag.StudsOffset = Vector3.new(0, 2.5, 0)
			tag.AlwaysOnTop = true
			local text = Instance.new("TextLabel", tag)
			text.Size = UDim2.new(1, 0, 1, 0)
			text.BackgroundTransparency = 1
			text.Text = plr.leaderstats.Team.Value
			text.TextColor3 = (text.Text == "Murderer" and Color3.new(1,0,0)) or (text.Text == "Sheriff" and Color3.new(0,0,1)) or Color3.new(1,1,1)
			text.TextStrokeTransparency = 0
			text.TextScaled = true
		end
	end
end)

-------------------------------
-- AIMBOT & SILENT AIM FUNCTION
local function GetClosestTarget()
	local closest, dist = nil, math.huge
	for _, v in ipairs(Players:GetPlayers()) do
		if v ~= Plr and v.Character and v.Character:FindFirstChild(LockPart) and v.Team ~= Plr.Team then
			local screenPos, onScreen = Camera:WorldToScreenPoint(v.Character[LockPart].Position)
			local mag = (Vector2.new(Mouse.X, Mouse.Y) - Vector2.new(screenPos.X, screenPos.Y)).Magnitude
			if onScreen and mag < dist then
				dist = mag
				closest = v
			end
		end
	end
	return closest
end

-- Rainbow FOV
local FOVCircle = Drawing.new("Circle")
FOVCircle.Visible = true
FOVCircle.Radius = 100
FOVCircle.NumSides = 100
FOVCircle.Filled = false
FOVCircle.Thickness = 1
FOVCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

RunService.RenderStepped:Connect(function()
	local hue = tick() % 5 / 5
	FOVCircle.Color = Color3.fromHSV(hue, 1, 1)
	FOVCircle.Position = Vector2.new(Mouse.X, Mouse.Y)
	FOVCircle.Visible = AimbotOn or SilentAimOn

	-- Aimbot
	if AimbotOn then
		local target = GetClosestTarget()
		if target and target.Character and target.Character:FindFirstChild(LockPart) then
			Camera.CFrame = CFrame.new(Camera.CFrame.Position, target.Character[LockPart].Position)
		end
	end
end)

-- Silent Aim Redirect
local __namecall
__namecall = hookmetamethod(game, "__namecall", function(self, ...)
	local args = {...}
	if SilentAimOn and tostring(self) == "Hit" and typeof(args[1]) == "Instance" then
		local target = GetClosestTarget()
		if target and target.Character and target.Character:FindFirstChild("Head") then
			args[1] = target.Character.Head
			return __namecall(self, unpack(args))
		end
	end
	return __namecall(self, ...)
end)

-- HITBOX
RunService.RenderStepped:Connect(function()
	for _, v in pairs(Players:GetPlayers()) do
		if v ~= Plr and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
			local part = v.Character:FindFirstChild("HumanoidRootPart")
			if HitboxOn then
				part.Size = Vector3.new(HitboxSize, HitboxSize, HitboxSize)
				part.Transparency = 0.75
				part.Material = Enum.Material.Neon
				part.CanCollide = false
			else
				part.Size = Vector3.new(2, 2, 1)
				part.Transparency = 1
			end
		end
	end
end)

-- FLY
local vel = Instance.new("BodyVelocity")
vel.MaxForce = Vector3.new(1, 1, 1) * 100000

RunService.RenderStepped:Connect(function()
	if FlyOn and Plr.Character and Plr.Character:FindFirstChild("HumanoidRootPart") then
		local hrp = Plr.Character.HumanoidRootPart
		vel.Velocity = (Camera.CFrame.LookVector) * FlySpeed * 10
		vel.Parent = hrp
	else
		vel.Parent = nil
	end
end)
