--// COCO HUB - FULL MM2 WITH HEAD/BODY LOCK AIMBOT

-- Load Rayfield UI
local success, Rayfield = pcall(function()
    return loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
end)
if not success or not Rayfield then return warn("‚ùå Failed to load Rayfield UI.") end

local Players, Plr = game:GetService("Players"), Players.LocalPlayer
local Camera = workspace.CurrentCamera
repeat task.wait() until Plr and Plr.Character and Plr.Character:FindFirstChild("HumanoidRootPart")

-- Variables
local ESPEnabled, highJump, aimbotEnabled, silentEnabled = false, false, false, false
local fov, silentFOV, walkSpeed = 100, 120, 16
local lockPart = "Head" -- or "HumanoidRootPart"
local fovCircle, silentCircle, silentTarget

-- Team Tag
local TeamTagEnabled, TeamTags = false, {}

local function getMM2Team(player)
    local ls = player:FindFirstChild("leaderstats")
    if ls then
        local tv = ls:FindFirstChild("Team")
        if tv and tv:IsA("StringValue") then return tv.Value end
    end
    return "No Team"
end

local function createTag(player)
    if not player.Character or not player.Character:FindFirstChild("Head") then return end
    local head = player.Character.Head
    if head:FindFirstChild("TeamTagGui") then head.TeamTagGui:Destroy() end

    local board = Instance.new("BillboardGui", head)
    board.Name = "TeamTagGui"
    board.Size = UDim2.new(0,100,0,30)
    board.Adornee = head
    board.StudsOffset = Vector3.new(0,2.5,0)
    board.AlwaysOnTop = true

    local label = Instance.new("TextLabel", board)
    label.Size = UDim2.fromScale(1,1)
    label.BackgroundTransparency = 1
    label.TextScaled = true
    label.Font = Enum.Font.SourceSansBold
    label.TextStrokeTransparency = 0

    if TeamTags[player] then task.cancel(TeamTags[player]) end
    TeamTags[player] = task.spawn(function()
        while TeamTagEnabled and player.Parent do
            local t = getMM2Team(player)
            label.Text = t
            if t == "Innocent" then label.TextColor3 = Color3.new(0,1,0)
            elseif t == "Sheriff" then label.TextColor3 = Color3.new(0,0,1)
            elseif t == "Murderer" then label.TextColor3 = Color3.new(1,0,0)
            else label.TextColor3 = Color3.new(1,1,1) end
            task.wait(0.5)
        end
        board:Destroy()
    end)
end

local function removeTag(player)
    if TeamTags[player] then task.cancel(TeamTags[player]) end
    if player.Character and player.Character:FindFirstChild("TeamTagGui") then
        player.Character.TeamTagGui:Destroy()
    end
end

local function refreshTags(state)
    TeamTagEnabled = state
    if state then
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= Plr then createTag(p) end
        end
        Players.PlayerAdded:Connect(function(p)
            if TeamTagEnabled then
                p.CharacterAdded:Connect(function()
                    task.wait(1)
                    createTag(p)
                end)
            end
        end)
        Players.PlayerRemoving:Connect(removeTag)
    else
        for _, p in pairs(Players:GetPlayers()) do removeTag(p) end
    end
end

-- Aimbot helpers
local function getClosest(r)
    local best, bestDist = nil, 1e9
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= Plr and p.Character then
            local part = p.Character:FindFirstChild(lockPart)
            if part then
                local pos, on = Camera:WorldToViewportPoint(part.Position)
                if on then
                    local d = (Vector2.new(pos.X,pos.Y) - Vector2.new(Camera.ViewportSize.X/2,Camera.ViewportSize.Y/2)).Magnitude
                    if d < r and d < bestDist then best, bestDist = part, d end
                end
            end
        end
    end
    return best
end

-- Silent aim hook
local oldNC = hookmetamethod(game, "__namecall", function(self, ...)
    local method = getnamecallmethod()
    local args = {...}
    if method == "FireServer" and tostring(self) == "Shoot" and silentEnabled and silentTarget then
        if typeof(args[1])=="Vector3" then
            args[1] = silentTarget.Position + Vector3.new(0,1.5,0)
            return oldNC(self, unpack(args))
        end
    end
    return oldNC(self, ...)
end)

-- UI
local Win = Rayfield:CreateWindow({Name="COCO HUB"})
local Tab = Win:CreateTab("Main")

-- ESP toggle
Tab:CreateToggle({Name="ESP", CurrentValue=ESPEnabled, Callback=function(s)
    ESPEnabled = s
    if s then
        task.spawn(function()
            while ESPEnabled do
                task.wait(0.5)
                for _, v in pairs(Players:GetPlayers()) do
                    if v ~= Plr and v.Character and not v.Character:FindFirstChild("ESP") then
                        local hl = Instance.new("Highlight", v.Character)
                        hl.Name="ESP"; hl.FillColor=Color3.new(0,1,0); hl.OutlineColor=Color3.new(1,1,0); hl.FillTransparency=0.5; hl.OutlineTransparency=0
                    end
                end
            end
            for _, v in pairs(Players:GetPlayers()) do
                if v.Character and v.Character:FindFirstChild("ESP") then
                    v.Character.ESP:Destroy()
                end
            end
        end)
    else
        for _, v in pairs(Players:GetPlayers()) do
            if v.Character and v.Character:FindFirstChild("ESP") then v.Character.ESP:Destroy() end
        end
    end
end})

-- High Jump
Tab:CreateToggle({Name="High Jump", CurrentValue=highJump, Callback=function(s)
    highJump = s
    local h = Plr.Character and Plr.Character:FindFirstChild("Humanoid")
    if h then h.JumpPower = s and 100 or 50 end
end})

-- WalkSpeed
Tab:CreateSlider({Name="WalkSpeed", Range={16,100}, Increment=1, CurrentValue=walkSpeed, Callback=function(v) walkSpeed=v end})
Tab:CreateToggle({Name="Enable WalkSpeed", CurrentValue=false, Callback=function(s)
    local h = Plr.Character and Plr.Character:FindFirstChild("Humanoid")
    if h then h.WalkSpeed = s and walkSpeed or 16 end
end})

-- Aim lock part selection
Tab:CreateDropdown({Name="Lock To", Options={"Head","HumanoidRootPart"}, CurrentOption="Head", Callback=function(val)
    lockPart = val
end})

-- Aimbot
Tab:CreateToggle({Name="Aimbot (FOV)", CurrentValue=aimbotEnabled, Callback=function(s)
    aimbotEnabled = s
    if fovCircle then fovCircle:Remove(); fovCircle=nil end
    if s then
        fovCircle = Drawing.new("Circle")
        fovCircle.Radius, fovCircle.Thickness, fovCircle.Transparency, fovCircle.Filled, fovCircle.Visible = fov, 2, 0.5, false, true
        task.spawn(function()
            while aimbotEnabled do
                task.wait()
                fovCircle.Position = Vector2.new(Camera.ViewportSize.X/2,Camera.ViewportSize.Y/2)
                fovCircle.Color = Color3.fromHSV((tick()%5)/5,1,1)
                local tgt = getClosest(fov)
                if tgt then Camera.CFrame = CFrame.new(Camera.CFrame.Position, tgt.Position) end
            end
            if fovCircle then fovCircle:Remove() end
        end)
    end
end})
Tab:CreateSlider({Name="FOV", Range={100,500}, Increment=10, CurrentValue=fov, Callback=function(v)
    fov = v; if fovCircle then fovCircle.Radius = v end
end})

-- Silent Aimbot
Tab:CreateToggle({Name="Silent Aim", CurrentValue=silentEnabled, Callback=function(s)
    silentEnabled = s
    if silentCircle then silentCircle:Remove(); silentCircle=nil end
    if s then
        silentCircle = Drawing.new("Circle")
        silentCircle.Radius, silentCircle.Thickness, silentCircle.Transparency, silentCircle.Visible = silentFOV, 2, 0.5, true
        task.spawn(function()
            while silentEnabled do
                task.wait()
                silentCircle.Position = Vector2.new(Camera.ViewportSize.X/2,Camera.ViewportSize.Y/2)
                silentCircle.Color = Color3.fromHSV((tick()%5)/5,1,1)
                silentTarget = getClosest(silentFOV)
            end
            if silentCircle then silentCircle:Remove() end
        end)
    end
end})
Tab:CreateSlider({Name="Silent FOV", Range={50,500}, Increment=10, CurrentValue=silentFOV, Callback=function(v)
    silentFOV = v; if silentCircle then silentCircle.Radius = v end
end})

-- Team Tag toggle
Tab:CreateToggle({Name="Team Tags", CurrentValue=TeamTagEnabled, Callback=refreshTags})

-- Unload
Tab:CreateButton({Name="Unload", Callback=function()
    if fovCircle then fovCircle:Remove() end
    if silentCircle then silentCircle:Remove() end
    refreshTags(false)
    for _, v in pairs(Players:GetPlayers()) do
        if v.Character and v.Character:FindFirstChild("ESP") then v.Character.ESP:Destroy() end
    end
    local h = Plr.Character and Plr.Character:FindFirstChild("Humanoid")
    if h then h.WalkSpeed=16; h.JumpPower=50 end
    aimbotEnabled = ESPEnabled = highJump = silentEnabled = false
    print("[COCO HUB] Unloaded.")
end})

print("[COCO HUB] Script running!")
